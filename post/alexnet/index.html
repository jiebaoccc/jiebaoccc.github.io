<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="AlexNet架构 代码实现 1. model.py import torch from torchsummary import summary from torch import nn import torch.nn.functional as F class AlexNet(nn.Module): def __init__(self): super(AlexNet,self).__init__() self.relu = nn.ReLU() self.conv1 = nn.Conv2d(1,96,11,4) self.pool1 = nn.MaxPool2d(3,2) self.conv2 = nn.Conv2d(96,256,5,padding=2) self.pool2 = nn.MaxPool2d(3,2) self.conv3 = nn.Conv2d(256,384,3,padding=1) self.conv4 = nn.Conv2d(384,384,3,padding=1) self.conv5 = nn.Conv2d(384,256,3,padding=1) self.pool3 = nn.MaxPool2d(3,2) self.flatten = nn.Flatten() self.linear1 = nn.Linear(6*6*256,4096) self.linear2 = nn.Linear(4096,4096) self.linear3 = nn.Linear(4096,10) def forward(self,x): x = self.relu(self.conv1(x)) x = self.pool1(x) x = self.">
<title>Alexnet</title>

<link rel='canonical' href='https://jiebaoccc.github.io/post/alexnet/'>

<link rel="stylesheet" href="/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="Alexnet">
<meta property='og:description' content="AlexNet架构 代码实现 1. model.py import torch from torchsummary import summary from torch import nn import torch.nn.functional as F class AlexNet(nn.Module): def __init__(self): super(AlexNet,self).__init__() self.relu = nn.ReLU() self.conv1 = nn.Conv2d(1,96,11,4) self.pool1 = nn.MaxPool2d(3,2) self.conv2 = nn.Conv2d(96,256,5,padding=2) self.pool2 = nn.MaxPool2d(3,2) self.conv3 = nn.Conv2d(256,384,3,padding=1) self.conv4 = nn.Conv2d(384,384,3,padding=1) self.conv5 = nn.Conv2d(384,256,3,padding=1) self.pool3 = nn.MaxPool2d(3,2) self.flatten = nn.Flatten() self.linear1 = nn.Linear(6*6*256,4096) self.linear2 = nn.Linear(4096,4096) self.linear3 = nn.Linear(4096,10) def forward(self,x): x = self.relu(self.conv1(x)) x = self.pool1(x) x = self.">
<meta property='og:url' content='https://jiebaoccc.github.io/post/alexnet/'>
<meta property='og:site_name' content='Carp&#39;s blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-09-21T19:21:51&#43;08:00'/><meta property='article:modified_time' content='2024-09-21T19:21:51&#43;08:00'/>
<meta name="twitter:title" content="Alexnet">
<meta name="twitter:description" content="AlexNet架构 代码实现 1. model.py import torch from torchsummary import summary from torch import nn import torch.nn.functional as F class AlexNet(nn.Module): def __init__(self): super(AlexNet,self).__init__() self.relu = nn.ReLU() self.conv1 = nn.Conv2d(1,96,11,4) self.pool1 = nn.MaxPool2d(3,2) self.conv2 = nn.Conv2d(96,256,5,padding=2) self.pool2 = nn.MaxPool2d(3,2) self.conv3 = nn.Conv2d(256,384,3,padding=1) self.conv4 = nn.Conv2d(384,384,3,padding=1) self.conv5 = nn.Conv2d(384,256,3,padding=1) self.pool3 = nn.MaxPool2d(3,2) self.flatten = nn.Flatten() self.linear1 = nn.Linear(6*6*256,4096) self.linear2 = nn.Linear(4096,4096) self.linear3 = nn.Linear(4096,10) def forward(self,x): x = self.relu(self.conv1(x)) x = self.pool1(x) x = self.">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu8602028200308506927.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Carp&#39;s blog</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/alexnet/">Alexnet</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 21, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    4 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="alexnet架构">AlexNet架构
</h1><p><img src="/Alexnet_img/3.png"
	
	
	
	loading="lazy"
	
		alt="3"
	
	
></p>
<p><img src="/Alexnet_img/2.png"
	
	
	
	loading="lazy"
	
		alt="2"
	
	
></p>
<p><img src="/Alexnet_img/1.png"
	
	
	
	loading="lazy"
	
		alt="1"
	
	
></p>
<p><img src="/Alexnet_img/5.png"
	
	
	
	loading="lazy"
	
		alt="5"
	
	
></p>
<p><img src="/Alexnet_img/4.png"
	
	
	
	loading="lazy"
	
		alt="4"
	
	
></p>
<h1 id="代码实现">代码实现
</h1><h2 id="1-modelpy">1. model.py
</h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torchsummary <span style="color:#f92672">import</span> summary
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torch <span style="color:#f92672">import</span> nn
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.nn.functional  <span style="color:#66d9ef">as</span> F
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AlexNet</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        super(AlexNet,self)<span style="color:#f92672">.</span>__init__()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>relu <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>ReLU()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>conv1 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">96</span>,<span style="color:#ae81ff">11</span>,<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pool1 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>MaxPool2d(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>conv2 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">96</span>,<span style="color:#ae81ff">256</span>,<span style="color:#ae81ff">5</span>,padding<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pool2 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>MaxPool2d(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>conv3 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">256</span>,<span style="color:#ae81ff">384</span>,<span style="color:#ae81ff">3</span>,padding<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>conv4 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">384</span>,<span style="color:#ae81ff">384</span>,<span style="color:#ae81ff">3</span>,padding<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>conv5 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">384</span>,<span style="color:#ae81ff">256</span>,<span style="color:#ae81ff">3</span>,padding<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pool3 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>MaxPool2d(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>flatten <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Flatten()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear1 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">6</span><span style="color:#f92672">*</span><span style="color:#ae81ff">6</span><span style="color:#f92672">*</span><span style="color:#ae81ff">256</span>,<span style="color:#ae81ff">4096</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear2 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">4096</span>,<span style="color:#ae81ff">4096</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>linear3 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">4096</span>,<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self,x):
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>conv1(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool1(x)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>conv2(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool2(x)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>conv3(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>conv4(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>conv5(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool3(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>flatten(x)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>linear1(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>dropout(x,<span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>linear2(x))
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>dropout(x,<span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>linear3(x)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;cuda&#34;</span> <span style="color:#66d9ef">if</span> torch<span style="color:#f92672">.</span>cuda<span style="color:#f92672">.</span>is_available() <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> AlexNet()<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>    print(summary(model,(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">227</span>,<span style="color:#ae81ff">227</span>)))   <span style="color:#75715e"># 打印模型信息</span>
</span></span></code></pre></div><h2 id="2-trainpy">2. train.py
</h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> copy
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.nn <span style="color:#66d9ef">as</span> nn
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.utils.data <span style="color:#66d9ef">as</span> data
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torchvision.datasets <span style="color:#f92672">import</span> FashionMNIST
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torchvision <span style="color:#f92672">import</span> transforms
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> model <span style="color:#f92672">import</span> AlexNet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">train_val_data_process</span>():
</span></span><span style="display:flex;"><span>    train_dataset <span style="color:#f92672">=</span> FashionMNIST(
</span></span><span style="display:flex;"><span>        root<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./data&#39;</span>,  <span style="color:#75715e"># 指定下载文件夹</span>
</span></span><span style="display:flex;"><span>        train<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,  <span style="color:#75715e"># 只下载训练集</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 归一化处理数据集</span>
</span></span><span style="display:flex;"><span>        transform<span style="color:#f92672">=</span>transforms<span style="color:#f92672">.</span>Compose([transforms<span style="color:#f92672">.</span>Resize(size<span style="color:#f92672">=</span><span style="color:#ae81ff">227</span>),
</span></span><span style="display:flex;"><span>                                      transforms<span style="color:#f92672">.</span>ToTensor()]),  <span style="color:#75715e"># 数据转换成张量形式，方便模型应用</span>
</span></span><span style="display:flex;"><span>        download<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>  <span style="color:#75715e"># 下载数据</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 划分训练集和验证集</span>
</span></span><span style="display:flex;"><span>    train_data, val_data <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>random_split(train_dataset,
</span></span><span style="display:flex;"><span>                                             [round(<span style="color:#ae81ff">0.8</span> <span style="color:#f92672">*</span> len(train_dataset)), round(<span style="color:#ae81ff">0.2</span> <span style="color:#f92672">*</span> len(train_dataset))])
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 训练集加载</span>
</span></span><span style="display:flex;"><span>    train_dataloader <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>DataLoader(dataset<span style="color:#f92672">=</span>train_data,
</span></span><span style="display:flex;"><span>                                       batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,  <span style="color:#75715e"># 一个批次数据的数量</span>
</span></span><span style="display:flex;"><span>                                       shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,  <span style="color:#75715e"># 数据打乱</span>
</span></span><span style="display:flex;"><span>                                       num_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)  <span style="color:#75715e"># 分配的进程数目</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 验证集加载</span>
</span></span><span style="display:flex;"><span>    val_dataloader <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>DataLoader(dataset<span style="color:#f92672">=</span>val_data,
</span></span><span style="display:flex;"><span>                                     batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,
</span></span><span style="display:flex;"><span>                                     shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                                     num_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> train_dataloader, val_dataloader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">train_model_process</span>(model, train_dataloader, val_dataloader, num_epochs):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 定义训练使用的设备，有GPU则用，没有则用CPU</span>
</span></span><span style="display:flex;"><span>    device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;cuda&#34;</span> <span style="color:#66d9ef">if</span> torch<span style="color:#f92672">.</span>cuda<span style="color:#f92672">.</span>is_available() <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 使用Adam优化器进行模型参数更新，学习率为0.001</span>
</span></span><span style="display:flex;"><span>    optimizer <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>optim<span style="color:#f92672">.</span>Adam(model<span style="color:#f92672">.</span>parameters(), lr<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 损失函数为交叉熵损失函数</span>
</span></span><span style="display:flex;"><span>    criterion <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>CrossEntropyLoss()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将模型放入训练设备内</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 复制当前模型参数(w,b等)，以便将最好的模型参数权重保存下来</span>
</span></span><span style="display:flex;"><span>    best_model_wts <span style="color:#f92672">=</span> copy<span style="color:#f92672">.</span>deepcopy(model<span style="color:#f92672">.</span>state_dict())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 初始化参数</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 最高准确度</span>
</span></span><span style="display:flex;"><span>    best_acc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 训练集损失值列表</span>
</span></span><span style="display:flex;"><span>    train_loss_all <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 验证集损失值列表</span>
</span></span><span style="display:flex;"><span>    val_loss_all <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 训练集准确度列表</span>
</span></span><span style="display:flex;"><span>    train_acc_all <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 验证集准确度列表</span>
</span></span><span style="display:flex;"><span>    val_acc_all <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 当前时间</span>
</span></span><span style="display:flex;"><span>    since <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> epoch <span style="color:#f92672">in</span> range(num_epochs):
</span></span><span style="display:flex;"><span>        model<span style="color:#f92672">.</span>load_state_dict(torch<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;./model_save/AlexNet_best_model.pth&#39;</span>))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Epoch </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(epoch, num_epochs <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 初始化参数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 训练集损失值</span>
</span></span><span style="display:flex;"><span>        train_loss <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 训练集精确度</span>
</span></span><span style="display:flex;"><span>        train_corrects <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 验证集损失值</span>
</span></span><span style="display:flex;"><span>        val_loss <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 验证集精确度</span>
</span></span><span style="display:flex;"><span>        val_corrects <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 训练集样本数量</span>
</span></span><span style="display:flex;"><span>        train_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 验证集样本数量</span>
</span></span><span style="display:flex;"><span>        val_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 对每一个mini-batch训练和计算</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> step, (b_x, b_y) <span style="color:#f92672">in</span> enumerate(train_dataloader):
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将特征放入到训练设备中</span>
</span></span><span style="display:flex;"><span>            b_x <span style="color:#f92672">=</span> b_x<span style="color:#f92672">.</span>to(device)  <span style="color:#75715e"># batch_size*28*28*1的tensor数据</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将标签放入到训练设备中</span>
</span></span><span style="display:flex;"><span>            b_y <span style="color:#f92672">=</span> b_y<span style="color:#f92672">.</span>to(device)  <span style="color:#75715e"># batch_size大小的向量tensor数据</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 设置模型为训练模式</span>
</span></span><span style="display:flex;"><span>            model<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 前向传播过程，输入为一个batch，输出为一个batch中对应的预测</span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> model(b_x)  <span style="color:#75715e"># 输出为：batch_size大小的行和10列组成的矩阵</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 查找每一行中最大值对应的行标</span>
</span></span><span style="display:flex;"><span>            pre_lab <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>argmax(output, dim<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># batch_size大小的向量表示属于物品的标签</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 计算每一个batch的损失函数，向量形式的交叉熵损失函数</span>
</span></span><span style="display:flex;"><span>            loss <span style="color:#f92672">=</span> criterion(output, b_y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将梯度初始化为0，防止梯度累积</span>
</span></span><span style="display:flex;"><span>            optimizer<span style="color:#f92672">.</span>zero_grad()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 反向传播计算</span>
</span></span><span style="display:flex;"><span>            loss<span style="color:#f92672">.</span>backward()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 根据网络反向传播的梯度信息来更新网络的参数，以起到降低loss函数计算值的作用</span>
</span></span><span style="display:flex;"><span>            optimizer<span style="color:#f92672">.</span>step()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 对损失函数进行累加，该批次的loss值乘于该批次数量得到批次总体loss值，在将其累加得到轮次总体loss值</span>
</span></span><span style="display:flex;"><span>            train_loss <span style="color:#f92672">+=</span> loss<span style="color:#f92672">.</span>item() <span style="color:#f92672">*</span> b_x<span style="color:#f92672">.</span>size(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 如果预测正确，则准确度train_corrects加1</span>
</span></span><span style="display:flex;"><span>            train_corrects <span style="color:#f92672">+=</span> torch<span style="color:#f92672">.</span>sum(pre_lab <span style="color:#f92672">==</span> b_y<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 当前用于训练的样本数量</span>
</span></span><span style="display:flex;"><span>            train_num <span style="color:#f92672">+=</span> b_x<span style="color:#f92672">.</span>size(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> step, (b_x, b_y) <span style="color:#f92672">in</span> enumerate(val_dataloader):
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将特征放入到验证设备中</span>
</span></span><span style="display:flex;"><span>            b_x <span style="color:#f92672">=</span> b_x<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将标签放入到验证设备中</span>
</span></span><span style="display:flex;"><span>            b_y <span style="color:#f92672">=</span> b_y<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 设置模型为评估模式</span>
</span></span><span style="display:flex;"><span>            model<span style="color:#f92672">.</span>eval()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 前向传播过程，输入为一个batch，输出为一个batch中对应的预测</span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> model(b_x)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 查找每一行中最大值对应的行标</span>
</span></span><span style="display:flex;"><span>            pre_lab <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>argmax(output, dim<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 计算每一个batch的损失函数</span>
</span></span><span style="display:flex;"><span>            loss <span style="color:#f92672">=</span> criterion(output, b_y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 对损失函数进行累加</span>
</span></span><span style="display:flex;"><span>            val_loss <span style="color:#f92672">+=</span> loss<span style="color:#f92672">.</span>item() <span style="color:#f92672">*</span> b_x<span style="color:#f92672">.</span>size(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 如果预测正确，则准确度val_corrects加1</span>
</span></span><span style="display:flex;"><span>            val_corrects <span style="color:#f92672">+=</span> torch<span style="color:#f92672">.</span>sum(pre_lab <span style="color:#f92672">==</span> b_y<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 当前用于验证的样本数量</span>
</span></span><span style="display:flex;"><span>            val_num <span style="color:#f92672">+=</span> b_x<span style="color:#f92672">.</span>size(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算并保存每一轮次迭代的loss值和准确率</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算并保存训练集的loss值</span>
</span></span><span style="display:flex;"><span>        train_loss_all<span style="color:#f92672">.</span>append(train_loss <span style="color:#f92672">/</span> train_num)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算并保存训练集的准确率</span>
</span></span><span style="display:flex;"><span>        train_acc_all<span style="color:#f92672">.</span>append(train_corrects<span style="color:#f92672">.</span>double()<span style="color:#f92672">.</span>item() <span style="color:#f92672">/</span> train_num)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算并保存验证集的loss值</span>
</span></span><span style="display:flex;"><span>        val_loss_all<span style="color:#f92672">.</span>append(val_loss <span style="color:#f92672">/</span> val_num)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算并保存验证集的准确率</span>
</span></span><span style="display:flex;"><span>        val_acc_all<span style="color:#f92672">.</span>append(val_corrects<span style="color:#f92672">.</span>double()<span style="color:#f92672">.</span>item() <span style="color:#f92672">/</span> val_num)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 打印每一轮次的loss值和准确度</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> train loss:</span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74"> train acc: </span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(epoch, train_loss_all[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], train_acc_all[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> val loss:</span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74"> val acc: </span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(epoch, val_loss_all[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], val_acc_all[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> val_acc_all[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">&gt;</span> best_acc:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 保存当前最高准确度</span>
</span></span><span style="display:flex;"><span>            best_acc <span style="color:#f92672">=</span> val_acc_all[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 保存当前最高准确度的模型参数</span>
</span></span><span style="display:flex;"><span>            best_model_wts <span style="color:#f92672">=</span> copy<span style="color:#f92672">.</span>deepcopy(model<span style="color:#f92672">.</span>state_dict())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 计算训练和验证的耗时</span>
</span></span><span style="display:flex;"><span>        time_use <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> since
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;训练和验证耗费的时间</span><span style="color:#e6db74">{:.0f}</span><span style="color:#e6db74">m</span><span style="color:#e6db74">{:.0f}</span><span style="color:#e6db74">s&#34;</span><span style="color:#f92672">.</span>format(time_use <span style="color:#f92672">//</span> <span style="color:#ae81ff">60</span>, time_use <span style="color:#f92672">%</span> <span style="color:#ae81ff">60</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 选择最优参数，保存最优参数的模型</span>
</span></span><span style="display:flex;"><span>    torch<span style="color:#f92672">.</span>save(best_model_wts, <span style="color:#e6db74">&#34;./model_save/AlexNet_best_model.pth&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将产生的数据保存成表格，方便查看</span>
</span></span><span style="display:flex;"><span>    train_process <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;epoch&#34;</span>: range(num_epochs),
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">&#34;train_loss_all&#34;</span>: train_loss_all,
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">&#34;val_loss_all&#34;</span>: val_loss_all,
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">&#34;train_acc_all&#34;</span>: train_acc_all,
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">&#34;val_acc_all&#34;</span>: val_acc_all})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> train_process
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">matplot_acc_loss</span>(train_process):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 显示每一次迭代后的训练集和验证集的损失函数和准确率</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># 表示一行两列的第一张图</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(train_process[<span style="color:#e6db74">&#39;epoch&#39;</span>], train_process<span style="color:#f92672">.</span>train_loss_all, <span style="color:#e6db74">&#34;ro-&#34;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Train loss&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(train_process[<span style="color:#e6db74">&#39;epoch&#39;</span>], train_process<span style="color:#f92672">.</span>val_loss_all, <span style="color:#e6db74">&#34;bs-&#34;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Val loss&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;epoch&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Loss&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)  <span style="color:#75715e"># 表示一行两列的第二张图</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(train_process[<span style="color:#e6db74">&#39;epoch&#39;</span>], train_process<span style="color:#f92672">.</span>train_acc_all, <span style="color:#e6db74">&#34;ro-&#34;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Train acc&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(train_process[<span style="color:#e6db74">&#39;epoch&#39;</span>], train_process<span style="color:#f92672">.</span>val_acc_all, <span style="color:#e6db74">&#34;bs-&#34;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Val acc&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;epoch&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;acc&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 加载需要的模型</span>
</span></span><span style="display:flex;"><span>    AlexNet <span style="color:#f92672">=</span> AlexNet()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 加载数据集</span>
</span></span><span style="display:flex;"><span>    train_data, val_data <span style="color:#f92672">=</span> train_val_data_process()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 利用现有的模型进行模型的训练</span>
</span></span><span style="display:flex;"><span>    train_process <span style="color:#f92672">=</span> train_model_process(AlexNet, train_data, val_data, num_epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)  <span style="color:#75715e"># 注：由于硬件限制，只设置训练一轮(可修改)</span>
</span></span><span style="display:flex;"><span>    matplot_acc_loss(train_process)
</span></span></code></pre></div><h2 id="3-testpy">3. test.py
</h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.utils.data <span style="color:#66d9ef">as</span> data
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torchvision.datasets <span style="color:#f92672">import</span> FashionMNIST
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torchvision <span style="color:#f92672">import</span> transforms
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> model <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_data_process</span>():
</span></span><span style="display:flex;"><span>    test_data <span style="color:#f92672">=</span> FashionMNIST(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;./data&#34;</span>,
</span></span><span style="display:flex;"><span>        train<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,    <span style="color:#75715e"># 用测试集进行测试</span>
</span></span><span style="display:flex;"><span>        transform<span style="color:#f92672">=</span>transforms<span style="color:#f92672">.</span>Compose([transforms<span style="color:#f92672">.</span>Resize(<span style="color:#ae81ff">227</span>),
</span></span><span style="display:flex;"><span>                                      transforms<span style="color:#f92672">.</span>ToTensor()]),
</span></span><span style="display:flex;"><span>        download<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    test_dataloader <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>DataLoader(test_data,
</span></span><span style="display:flex;"><span>                                      batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e"># 该批次为1</span>
</span></span><span style="display:flex;"><span>                                      shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                                      num_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> test_dataloader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_model_process</span>(model,test_dataloader):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 设定测试所用到的设备</span>
</span></span><span style="display:flex;"><span>    device <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>device(<span style="color:#e6db74">&#34;cuda&#34;</span> <span style="color:#66d9ef">if</span> torch<span style="color:#f92672">.</span>cuda<span style="color:#f92672">.</span>is_available() <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;cpu&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将模型放入到训练设备中</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 初始化参数</span>
</span></span><span style="display:flex;"><span>    test_corrects <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>    test_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 只进行前向传播计算，不计算梯度，从而节省内存，加快运行速度</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x,y <span style="color:#f92672">in</span> test_dataloader:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将特征放入到测试设备中</span>
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将标签放入到测试设备中</span>
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> y<span style="color:#f92672">.</span>to(device)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 将模型设为评估模式</span>
</span></span><span style="display:flex;"><span>            model<span style="color:#f92672">.</span>eval()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 前向传播过程，输入为测试数据集，输出为对每个样本的预测值</span>
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> model(x)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 查找每一行中最大值对应的行标</span>
</span></span><span style="display:flex;"><span>            pre_lab <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>argmax(output,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 如果预测正确，则准确度加1</span>
</span></span><span style="display:flex;"><span>            test_corrects <span style="color:#f92672">+=</span> torch<span style="color:#f92672">.</span>sum(pre_lab <span style="color:#f92672">==</span> y<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 对所有的测试样本进行累加</span>
</span></span><span style="display:flex;"><span>            test_num <span style="color:#f92672">+=</span> x<span style="color:#f92672">.</span>size(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算测试准确度</span>
</span></span><span style="display:flex;"><span>    test_acc <span style="color:#f92672">=</span> test_corrects<span style="color:#f92672">.</span>double()<span style="color:#f92672">.</span>item() <span style="color:#f92672">/</span> test_num
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;测试正确率为</span><span style="color:#e6db74">{</span>test_acc<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 加载模型</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> AlexNet()
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>load_state_dict(torch<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#34;./model_save/AlexNet_best_model.pth&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 加载测试数据</span>
</span></span><span style="display:flex;"><span>    test_dataloader <span style="color:#f92672">=</span> test_data_process()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 加载模型测试的函数</span>
</span></span><span style="display:flex;"><span>    test_model_process(model,test_dataloader)
</span></span></code></pre></div>
</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Carp&#39;s blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
